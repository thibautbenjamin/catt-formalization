{-# OPTIONS --rewriting #-}

-- open import Prelude
open import Agda.Builtin.Equality
open import Agda.Builtin.Nat


module Syntax where
  
  data Ctx      : Set
  data Sub      : Ctx â†’ Ctx â†’ Set

  â…€ : Nat â†’ Ctx
  ğ”» : Nat â†’ Ctx

  record Ty (Î“ : Ctx) : Set where
    inductive
    constructor â‡’_[_]
    field
      dim : Nat
      def : Sub Î“ (â…€ dim)
  
  open Ty public
  
  data Tm       : âˆ€ Î“ â†’ Ty Î“ â†’ Set

  _[_]T : âˆ€ {Î“ Î”} (A : Ty Î”) (Î´ : Sub Î“ Î”) â†’ Ty Î“ 
  _[_]t : âˆ€ {Î“ Î”} {A : Ty Î”} (t : Tm Î” A) (Î´ : Sub Î“ Î”) â†’ Tm Î“ (A [ Î´ ]T) 

  data Ctx where
    âˆ™      : Ctx
    _,_    : âˆ€ Î“ â†’ Ty Î“ â†’ Ctx

      
  data Sub where
    Îµ      : âˆ€ {Î“} â†’ Sub Î“ âˆ™
    _â—‹_    : âˆ€ {Î“ Î” Î˜} â†’ Sub Î” Î˜ â†’ Sub Î“ Î” â†’ Sub Î“ Î˜
    _,_    : âˆ€ {Î“ Î”} (Î´ : Sub Î“ Î”) {A} â†’ Tm Î“ (A [ Î´ ]T) â†’ Sub Î“ (Î” , A)
    id     : âˆ€ {Î“} â†’ Sub Î“ Î“
    Ï€â‚     : âˆ€ {Î“ Î” A} â†’ Sub Î“ (Î” , A) â†’ Sub Î“ Î”
  
  A [ Î´ ]T = â‡’ dim A [ (def A) â—‹ Î´ ]

  
  data Tm where
    Ï€â‚‚_[_] : âˆ€ {Î“ Î”} A â†’ (Î´ : Sub Î“ (Î” , A)) â†’ Tm Î“ (A [ Ï€â‚ Î´ ]T)

  Tydef : âˆ€ (Î“ : Ctx) (n : Nat) â†’ Set
  Tydef Î“ n = Sub Î“ (â…€ n)

  -- Ty= : âˆ€ {Î“ : Con} {m n : Nat} (p : m == n) {A : Tydef Î“ m} {B : Tydef Î“ n} (q : A == B [ Tydef Î“ â†“ p ]) â†’ â‡’ m [ A ] == â‡’ n [ B ] 
  -- Ty= idp q = ap â‡’ _ [_] q

  -- Ty=transp : âˆ€ {Î“ : Con} {m n : â„•} (p : m == n) {A : Tydef Î“ m} {B : Tydef Î“ n} (q : transport (Tydef Î“) p A == B) â†’ â‡’ m [ A ] == â‡’ n [ B ]
  -- Ty=transp {Î“ = Î“} p q = Ty= p (from-transp (Tydef Î“) p q)  

  -- ,=transp : âˆ€ {Î“ Î” : Con} {Î´â‚€ Î´â‚ : Tms Î“ Î”} (p : Î´â‚€ == Î´â‚) {A : Ty Î”} {tâ‚€ : Tm Î“ (A [ Î´â‚€ ]T)} {tâ‚ : Tm Î“ (A [ Î´â‚ ]T)} (q :  tâ‚ == transport (Î» Ïƒ â†’ Tm Î“ (A [ Ïƒ ]T)) p tâ‚€) â†’  _==_ {A = Tms Î“ (Î” , A)} (Î´â‚€ , tâ‚€) (Î´â‚ , tâ‚)
  -- ,=transp {Î“} idp idp = idp  



-- transpâ—‹ : âˆ€ {m n Î“ Î”} {Î´ : Tms Î” (â…€ m)} {Ïƒ : Tms Î“ Î”} (p : m == n) â†’ transport (Tydef Î“) p (Î´ â—‹ Ïƒ) == ((transport (Tydef Î”) p Î´) â—‹ Ïƒ)  
  -- transpâ—‹ idp = idp


  -- postulate
    -- idâ—‹    : âˆ€ {Î“ Î”} {Î´ : Tms Î“ Î”} â†’ (id â—‹ Î´) == Î´ 
    -- â—‹id    : âˆ€ {Î“ Î”} {Î´ : Tms Î“ Î”} â†’ (Î´ â—‹ id) == Î´  
    -- ass    : âˆ€ {Î“ Î” Î˜ Î} {Î½ : Tms Î“ Î”} {Î´ : Tms Î” Î˜} {Ïƒ : Tms Î˜ Î} â†’ ((Ïƒ â—‹ Î´) â—‹ Î½) == (Ïƒ â—‹ (Î´ â—‹ Î½))
    -- Ï€â‚â—‹    : âˆ€ {Î“ Î” Î˜ A} {Ïƒ : Tms Î“ Î”} {Î´ : Tms Î” (Î˜ , A)} â†’ (Ï€â‚ (Î´ â—‹ Ïƒ)) == (Ï€â‚ Î´ â—‹ Ïƒ) 

  -- Tynf :  âˆ€ {Î“ : Con} (A : Ty Î“) â†’ A == â‡’ dim A [ def A ]
  -- Tynf â‡’ dimâ‚ [ defâ‚ ] = idp
  -- {-# REWRITE Tynf #-}

  [][]T  : âˆ€ {Î“ Î” Î˜ : Ctx} {A : Ty Î˜} {Î´ : Sub Î” Î˜} {Ïƒ : Sub Î“ Î”} â†’  ((A [ Î´ ]T) [ Ïƒ ]T)  (A [ Î´ â—‹ Ïƒ ]T)
--  [][]T {A = A} = ap (Î» Ïƒ â†’ â‡’ dim A [ Ïƒ ]) ass
  [][]T = ?
  {-# REWRITE [][]T #-}
  

  -- _[_]t {Î“ = Î“} (Ï€â‚‚ A [ Î´â‚ ]) Î´ = transport (Î» Ïƒ  â†’ (Tm Î“ â‡’ dim A [ Ïƒ ])) (_âˆ™_ (ap (Î» Ïƒ â†’ def A â—‹ Ïƒ) Ï€â‚â—‹) (! ass)) (Ï€â‚‚ A [ Î´â‚ â—‹ Î´ ]) 
  _[_]t {Î“ = Î“} (Ï€â‚‚ A [ Î´â‚ ]) Î´ = {!!} -- coe {!A!} Ï€â‚‚ A [ Î´â‚ â—‹ Î´ ]

  postulate
   -- ,â—‹      : âˆ€ {Î“ Î” Î˜} {Ïƒ : Tms Î“ Î”} {Î´ : Tms Î” Î˜} {A : Ty Î˜} {t : Tm Î” (A [ Î´ ]T)} â†’ _==_ {A = Tms Î“ (Î˜ , A)} ((Î´ , t) â—‹ Ïƒ) ((Î´ â—‹ Ïƒ) , transport (Tm Î“) ([][]T A) (t [ Ïƒ ]t))
    Ï€â‚Î²    : âˆ€ {Î“ Î”} {Î´ : Sub Î“ Î”} {A} {t : Tm Î“ (A [ Î´ ]T)} â†’ (Ï€â‚ {A = A} (Î´ , t) == Î´)
    Ï€Î·     : âˆ€ {Î“ Î”} {A} {Î´ : Sub Î“ (Î” , A)} â†’ (Ï€â‚ Î´ , Ï€â‚‚ A [ Î´ ]) == Î´
    ÎµÎ·     : âˆ€ {Î“} {Ïƒ : Sub Î“ âˆ™} â†’ Ïƒ == Îµ



  ğ”» n = â…€ n , (â‡’ n [ id ])
  â…€ O = âˆ™
  â…€ (suc n) = ğ”» n , (â‡’ n [ Ï€â‚ id ])


  varTy :  Ctx â†’ Nat â†’ Set
  varTy Î“ n = Sub Î“ (ğ”» n)


  verif  : âˆ€ {Î“ : Ctx} {A : Ty Î“} â†’ (A [ id ]T) == A
  -- verif {A = A} = ap (Î» Ïƒ â†’ â‡’ dim A [ Ïƒ ]) â—‹id
  verif = ?

